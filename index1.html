<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8">
<title>æç™½è¯—æ„è¶³è¿¹åœ°å›¾</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Leaflet -->
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

<style>
  body {
    margin: 0;
    font-family: "KaiTi", serif;
    background: #fdf8f3;
  }
  #map {
    width: 100vw;
    height: 100vh;
  }
  /* ğŸŒ¸ æ§åˆ¶é¢æ¿æ ·å¼ï¼Œæµ®åœ¨åœ°å›¾ä¹‹ä¸Š */
  .control-panel {
    position: absolute;
    top: 15px;
    left: 15px;
    z-index: 1000; /* âœ… ä¿è¯åœ¨åœ°å›¾ä¸Šå±‚ */
    background: rgba(255, 255, 255, 0.92);
    padding: 10px 15px;
    border-radius: 10px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.25);
  }
  h2 {
    margin: 0;
    margin-bottom: 6px;
    font-size: 18px;
    color: #5a3e36;
    text-align: center;
  }
  button {
    font-size: 15px;
    margin: 5px;
    padding: 6px 14px;
    border-radius: 6px;
    border: none;
    background: #8b4513;
    color: white;
    cursor: pointer;
    transition: background 0.3s;
  }
  button:hover {
    background: #a0522d;
  }
</style>
</head>

<body>
<div id="map"></div>

<!-- æ§åˆ¶é¢æ¿ï¼šæµ®åŠ¨æŒ‰é’® -->
<div class="control-panel">
  <h2>ğŸ“œ æç™½è¯—æ„è¶³è¿¹</h2>
  <button id="playBtn">â–¶ æ’­æ”¾æ—…ç¨‹</button>
  <button id="pauseBtn">â¸ æš‚åœ</button>
</div>

<script>
/* === æç™½è¶³è¿¹æ•°æ® === */
const liBaiData = [
  {"place":"ç»µé˜³","province":"å››å·çœç»µé˜³å¸‚","latitude":31.47,"longitude":104.68,"year":701,"event":"å‡ºç”Ÿåœ°","poem":"å°‘å¹´è¡Œ","excerpt":"äº”é™µå¹´å°‘äº‰ç¼ å¤´ï¼Œä¸€æ›²çº¢ç»¡ä¸çŸ¥æ•°ã€‚","type":"é’å¹´è±ªæƒ…"},
  {"place":"é•¿å®‰","province":"é™•è¥¿çœè¥¿å®‰å¸‚","latitude":34.34,"longitude":108.94,"year":724,"event":"å…¥é•¿å®‰æ±‚ä»•","poem":"å¤é£å…¶åä¹","excerpt":"å¤§é›…ä¹…ä¸ä½œï¼Œå¾è¡°ç«Ÿè°é™ˆã€‚","type":"æ±‚ä»•å¤±æ„"},
  {"place":"æ´›é˜³","province":"æ²³å—çœæ´›é˜³å¸‚","latitude":34.62,"longitude":112.45,"year":726,"event":"è®¿å‹ä½œè¯—","poem":"å¿†ä¸œå±±äºŒé¦–","excerpt":"ä¸çŸ¥ä¹˜æœˆå‡ äººå½’ï¼Œè½æœˆæ‘‡æƒ…æ»¡æ±Ÿæ ‘ã€‚","type":"æ€å‹æƒ…æ„Ÿ"},
  {"place":"é»„é¹¤æ¥¼","province":"æ¹–åŒ—çœæ­¦æ±‰å¸‚","latitude":30.56,"longitude":114.31,"year":728,"event":"æ¸¸è§ˆä½œè¯—","poem":"é»„é¹¤æ¥¼é€å­Ÿæµ©ç„¶ä¹‹å¹¿é™µ","excerpt":"å­¤å¸†è¿œå½±ç¢§ç©ºå°½ï¼Œå”¯è§é•¿æ±Ÿå¤©é™…æµã€‚","type":"é€åˆ«æŠ’æƒ…"},
  {"place":"åºå±±","province":"æ±Ÿè¥¿çœä¹æ±Ÿå¸‚","latitude":29.57,"longitude":115.98,"year":732,"event":"æ¸¸å±±å†™æ™¯","poem":"æœ›åºå±±ç€‘å¸ƒ","excerpt":"é£æµç›´ä¸‹ä¸‰åƒå°ºï¼Œç–‘æ˜¯é“¶æ²³è½ä¹å¤©ã€‚","type":"å±±æ°´å£®ä¸½"},
  {"place":"å®£åŸ","province":"å®‰å¾½çœå®£åŸå¸‚","latitude":30.94,"longitude":118.76,"year":735,"event":"ä»»èŒä¸åˆ›ä½œ","poem":"å®£åŸè§æœé¹ƒèŠ±","excerpt":"èœ€å›½æ›¾é—»å­è§„é¸Ÿï¼Œå®£åŸè¿˜è§æœé¹ƒèŠ±ã€‚","type":"æ€ä¹¡æ„Ÿæ€€"},
  {"place":"å¤œéƒ","province":"è´µå·çœéµä¹‰å¸‚","latitude":27.73,"longitude":106.92,"year":759,"event":"è¢«è´¬é€”ä¸­","poem":"å¤œéƒå¯„å†…","excerpt":"å¤œéƒè¥¿å»æœˆæ‚ æ‚ ï¼Œæ°´å®¿é£é¤ä¸è‡ªç”±ã€‚","type":"å¤±æ„å¹½æ€¨"},
  {"place":"å½“æ¶‚","province":"å®‰å¾½çœé©¬éå±±å¸‚","latitude":31.57,"longitude":118.49,"year":762,"event":"ç—…é€åœ°","poem":"ä¸´ç»ˆè¯—","excerpt":"æµ®äº‘æ¸¸å­æ„ï¼Œè½æ—¥æ•…äººæƒ…ã€‚","type":"æ„Ÿæ…¨äººç”Ÿ"}
];
const emotionColors = {
  "é’å¹´è±ªæƒ…": "#e67e22",
  "æ±‚ä»•å¤±æ„": "#95a5a6",
  "æ€å‹æƒ…æ„Ÿ": "#2ecc71",
  "é€åˆ«æŠ’æƒ…": "#3498db",
  "å±±æ°´å£®ä¸½": "#9b59b6",
  "æ€ä¹¡æ„Ÿæ€€": "#f1c40f",
  "å¤±æ„å¹½æ€¨": "#34495e",
  "æ„Ÿæ…¨äººç”Ÿ": "#d35400"
};
/* === åˆå§‹åŒ–åœ°å›¾ === */
const map = L.map('map').setView([31, 110], 5);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
  maxZoom: 10,
  attribution: 'Â© OpenStreetMap'
}).addTo(map);

/* === æ ‡è®°ç‚¹ä¸è¿çº¿é€»è¾‘ === */
let markers = [];
let linePoints = [];
let polyline = null;
let playbackTimer = null;
let currentIndex = 0;
liBaiData.forEach(item => {
  const color = emotionColors[item.type] || "gray";
  const marker = L.circleMarker([item.latitude, item.longitude], {
    radius: 7, color: color, fillColor: color, fillOpacity: 0.8
  }).bindPopup(`
    <b>${item.place}ï¼ˆ${item.year}å¹´ï¼‰</b><br>
    ${item.event}<br>
    ã€Š${item.poem}ã€‹ï¼š${item.excerpt}<br>
    <i>${item.type}</i>
  `);
  markers.push(marker);
  marker.addTo(map);
});

/* === è¯­éŸ³æœ—è¯µ === */
function speakPoem(text){
  const msg = new SpeechSynthesisUtterance(text);
  msg.lang = 'zh-CN';
  msg.rate = 0.9;
  speechSynthesis.speak(msg);
}

/* === æ’­æ”¾æ—…ç¨‹ === */
function playJourney(){
  if(currentIndex >= liBaiData.length) currentIndex = 0;
  const item = liBaiData[currentIndex];
  map.setView([item.latitude, item.longitude], 7, {animate: true});
  markers[currentIndex].openPopup();
  speakPoem(`å…¬å…ƒ${item.year}å¹´ï¼Œæç™½åœ¨${item.place}ï¼š${item.excerpt}`);

  linePoints.push([item.latitude, item.longitude]);
  if(polyline) polyline.setLatLngs(linePoints);
  else polyline = L.polyline(linePoints, {color:"#8b4513", weight:4, opacity:0.8}).addTo(map);

  currentIndex++;
  if(currentIndex < liBaiData.length) playbackTimer = setTimeout(playJourney, 5500);
}

/* === æ§åˆ¶æŒ‰é’® === */
document.getElementById("playBtn").onclick = ()=>{
  clearTimeout(playbackTimer);
  linePoints = []; currentIndex=0;
  if(polyline){ map.removeLayer(polyline); polyline=null; }
  playJourney();
};
document.getElementById("pauseBtn").onclick = ()=>{
  clearTimeout(playbackTimer);
  speechSynthesis.cancel();
};
</script>
</body>
</html>
